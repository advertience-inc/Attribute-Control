___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Advertience Attribution Linker",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "Advertience Attribution Linker provides simple integration with the Advertience Attribution Solution.\nControl attribution to reflect the right channels to accurately measure success.",
  "containerContexts": [
    "WEB"
  ],
  "categories": [
    "ATTRIBUTION",
    "ANALYTICS",
    "MARKETING"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "clientTab",
    "displayName": "Client Tab",
    "simpleValueType": true,
    "valueHint": "TAB_NAME",
    "help": "Client Tab name in Advertience Attribution Solution"
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Inject script which adds a dataLayerPusher function to the window object, then call this new function in window, which will get UTM parameters from advertience API and push to dataLayer
const injectScript = require('injectScript');
const callInWindow = require('callInWindow');
const scriptUrl = 'https://cdn.jsdelivr.net/gh/advertience-inc/Attribution-Linker@v1.0.1/attributeControl.js';

injectScript(scriptUrl, onSuccess, data.gtmOnFailure);

function onSuccess() {
  callInWindow('attributeControl', data.clientTab);
  data.gtmOnSuccess();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "attributeControl"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://cdn.jsdelivr.net/gh/advertience-inc/Attribution-Linker@v1.0.1/attributeControl.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: InjectScript Success
  code: |-
    mock('injectScript', (str, onSuccess, onFailure) => onSuccess());

    runCode({});

    assertApi('gtmOnSuccess').wasCalled();
- name: InjectScript Success callInWindow
  code: |-
    mock('injectScript', (str, onSuccess, onFailure) => onSuccess());

    runCode({clientTab: 'test'});

    assertApi('callInWindow').wasCalledWith('attributeControl', 'test');
- name: InjectScript Failure
  code: |-
    mock('injectScript', (str, onSuccess, onFailure) => onFailure());

    runCode({});

    assertApi('gtmOnFailure').wasCalled();


___NOTES___

Created on 6/13/2023, 2:48:15 PM


